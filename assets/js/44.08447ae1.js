(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{376:function(s,a,t){"use strict";t.r(a);var r=t(0),e=Object(r.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"protocol-buffers学习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protocol-buffers学习"}},[s._v("#")]),s._v(" Protocol Buffers学习")]),s._v(" "),a("h2",{attrs:{id:"_1、什么是protocol-buffers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、什么是protocol-buffers"}},[s._v("#")]),s._v(" 1、什么是Protocol Buffers?")]),s._v(" "),a("p",[s._v("Protocol Buffers（简称 Protobuf）是由谷歌开发的一种用于序列化结构化数据的方法。它是一种语言中立、平台中立、可扩展的机制，用于高效地序列化数据格式")]),s._v(" "),a("p",[s._v("定义：")]),s._v(" "),a("ul",[a("li",[s._v("是一种轻便高效的序列化结构化数据"),a("em",[s._v("协议")])]),s._v(" "),a("li",[s._v("通常用在存储数据和需要远程数据通信的程序上")])]),s._v(" "),a("p",[s._v("目的：")]),s._v(" "),a("ul",[a("li",[s._v("加速站点之间数据传输速度")]),s._v(" "),a("li",[s._v("解决数据传输不规范问题")])]),s._v(" "),a("h2",{attrs:{id:"_2、编译器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、编译器"}},[s._v("#")]),s._v(" 2、编译器")]),s._v(" "),a("p",[s._v("Protobuf 提供了一个编译器 protoc，可以将 .proto 文件编译成不同编程语言的代码（如 C++、Java、Python、Go 等），以便在程序中使用这些数据结构。")]),s._v(" "),a("blockquote",[a("p",[s._v("protoc安装")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\nhttps://github.com/protocolbuffers/protobuf/releases/download/v27.1/protoc-27.1-linux-x86_64.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" protoc-27.1-linux-x86_64.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" bin/protoc /usr/local/bin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("用"),a("code",[s._v("protoc --version")]),s._v("检查是否安装成功")]),s._v(" "),a("h2",{attrs:{id:"_3、插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、插件"}},[s._v("#")]),s._v(" 3、插件")]),s._v(" "),a("p",[s._v("protocol buffer编译器需要一个插件来根据提供的proto文件生成代码，应对不同的语言或者框架我们要下载对应的插件才能生成其代码")]),s._v(" "),a("blockquote",[a("p",[s._v("golang插件")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("go "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" google.golang.org/protobuf/cmd/protoc-gen-go@latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("grpc插件")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("go "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("micro插件")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("go "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" github.com/go-micro/generator/cmd/protoc-gen-micro@latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_4、protocol-buffers-常用概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、protocol-buffers-常用概念"}},[s._v("#")]),s._v(" 4、Protocol Buffers 常用概念")]),s._v(" "),a("ul",[a("li",[s._v("Message：描述一个请求或响应的消息格式")]),s._v(" "),a("li",[s._v("字段标识：消息的定义中，每个字段都有一个唯一的数值标签")]),s._v(" "),a("li",[s._v("常用数据类型：double，float，int32/64，bool，string，bytes")]),s._v(" "),a("li",[s._v("Service服务定义：在Service中可以定义一个RPC服务接口")])]),s._v(" "),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("syntax = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"proto3"')]),s._v(";\n\npackage book;\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 声明生成Go代码的导入路径（import path）")]),s._v("\noption go_package = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./book"')]),s._v(";\n\nmessage Price "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    int64 market_price = "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(";  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 建议使用下划线的命名方式")]),s._v("\n    int64 sale_price = "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(";\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nservice BookService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  rpc Sell(Price) returns (Price);\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"_5、代码生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、代码生成"}},[s._v("#")]),s._v(" 5、代码生成")]),s._v(" "),a("h3",{attrs:{id:"目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[s._v("#")]),s._v(" 目录结构")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("demo\n└── proto\n    └── book\n        └── price.proto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"生成命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成命令"}},[s._v("#")]),s._v(" 生成命令")]),s._v(" "),a("blockquote",[a("p",[s._v("生成go代码")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("protoc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--proto_path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--go_out")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto book/price.proto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("--proto_path=proto")]),s._v(" 表示从proto目录下读取proto文件。")]),s._v(" "),a("li",[a("code",[s._v("--go_out=proto")]),s._v(" 表示生成的Go代码保存的路径。")])]),s._v(" "),a("blockquote",[a("p",[s._v("生成grpc代码")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("protoc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--proto_path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--go_out")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t   --go-grpc_out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t   book/price.proto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("生成micro代码")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("protoc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--proto_path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--micro_out")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--go_out")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t   book/price.proto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);